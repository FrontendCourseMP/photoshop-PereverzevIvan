(function(){"use strict";function d(g,r,m="rgb"){const{width:o,height:i,data:x}=g,f=new Uint8ClampedArray(x.length),h=(t,e,c)=>(t=Math.max(0,Math.min(o-1,t)),e=Math.max(0,Math.min(i-1,e)),x[(e*o+t)*4+c]),M=r.flat().reduce((t,e)=>t+e,0)||1;for(let t=0;t<i;t++)for(let e=0;e<o;e++){const c=(t*o+e)*4;if(m==="rgb"){for(let s=0;s<3;s++){let a=0;for(let n=0;n<3;n++)for(let l=0;l<3;l++){const u=e+l-1,p=t+n-1;a+=h(u,p,s)*r[n][l]}f[c+s]=Math.min(255,Math.max(0,a/M))}f[c+3]=h(e,t,3)}else if(m==="alpha"){for(let a=0;a<3;a++)f[c+a]=h(e,t,a);let s=0;for(let a=0;a<3;a++)for(let n=0;n<3;n++){const l=e+n-1,u=t+a-1;s+=h(l,u,3)*r[a][n]}f[c+3]=Math.min(255,Math.max(0,s/M))}}return new ImageData(f,o,i)}self.onmessage=g=>{const{imageData:r,kernel:m,mode:o}=g.data,i=d(r,m,o);self.postMessage(i)}})();
